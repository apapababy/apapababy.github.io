
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://obniz.io/js/jquery-3.2.1.min.js"></script>
  <script src="https://unpkg.com/obniz@3.5.0/obniz.js"></script>
</head>
<body>
  <div id="obniz-debug"></div>
  <button id="left" value="-1">Left</button>
  <button id="off" value="0">Off</button>
  <button id="right"value="1">Right</button>

  <script>
    var buffer1;
    var buffer0;
      ////////////////////
    /*
        var g_receiveArray = new Array(20);
        var obnizB = new Obniz("9200-9797");//5804-9699
        obnizB.onconnect = async function(){
          obnizB.getIO(2).output(false);
          obnizB.getIO(3).output(true);
          obnizB.uart0.start({tx:0, rx:1, baud:9600});
    */      
          var countup = function(){
         console.log(count++);
         }
          
          
         while(1){        
            $("#left").on("click",function(){
              GvsOutPut(1,4000);
                obnizB.display.clear();
                obnizB.display.print("LEFT");
                console.log(buffer0,buffer1);
                obnizB.uart0.send(buffer0);
                obnizB.uart0.send(buffer1);
                //console.log(buffer0,buffer1);
              obnizB.display.print(buffer0,buffer1);
               var id = setInterval(function(){
                countup();
                if(count > 5){　
                  clearInterval(id);　//idをclearIntervalで指定している
                }}, 1000);
              
              });
            $("#right").on("click",function(){
              GvsOutPut(1,-4000);
              obnizB.display.clear();
              obnizB.display.print("RIGHT");
              console.log(buffer0,buffer1);
              obnizB.uart0.send(buffer0);
              obnizB.uart0.send(buffer1);
              //obnizB.display.print(buffer0,buffer1);
            });
            $("#off").on("click",function(){
              obnizB.display.clear();
              obnizB.display.print("OFF");
              GvsOutPut(1,0);
              console.log(buffer0,buffer1);
              obnizB.uart0.send(buffer0);
              obnizB.uart0.send(buffer1);
              //console.log(buffer0,buffer1);
              obnizB.display.print(buffer0,buffer1);
            });
         }
            //await obnizB.wait(10);  //wait for 10ms
        }
      /////////////////////////////////////////////////
        function GvsOutPut(chan, Value){
        var Send1 = new Int8Array(8);
        var Send2 = new Int8Array(8);
        var i = 0;
        Send1[0]=0;Send1[1]=0;Send1[2]=0;Send1[3]=0;Send1[4]=0;Send1[5]=0;Send1[6]=0;Send1[7]=0;
        Send2[0]=0;Send2[1]=0;Send2[2]=0;Send2[3]=0;Send2[4]=0;Send2[5]=0;Send2[6]=0;Send2[7]=0;

        if(chan == '1'){Send1[7]=0;Send1[6]=0;Send1[5]=1;}
        else if(chan == '2'){Send1[7]=0;Send1[6]=1;Send1[5]=0;}
        else if(chan == '3'){Send1[7]=0;Send1[6]=1;Send1[5]=1;}
        else if(chan == '0'){Send1[7]=0;Send1[6]=0;Send1[5]=0;}

        if(Value >= 0) Send1[4] = 1;
        else Value = Value * (-1);

        /* 10進数を2進数に変換 */
        for(i=0;i<=7;i++){
          Send2[i] = Value % 2;
          Value = Value / 2; 
        }
        for(i=0;i<=3;i++){
          Send1[i] = Value % 2;
          Value = Value / 2; 
        }

        buffer0 = (Send1[7]*128 + Send1[6]*64 + Send1[5]*32 + Send1[4]*16 + Send1[3]*8 + Send1[2]*4 + Send1[1]*2 + Send1[0]);
        buffer1 = (Send2[7]*128 + Send2[6]*64 + Send2[5]*32 + Send2[4]*16 + Send2[3]*8 + Send2[2]*4 + Send2[1]*2 + Send2[0]);
      }
  </script>
</body>

</html>

